<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é™€èºå„€è¨ºæ–· v2</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{background:#06010f;color:#fff;font-family:monospace;padding:16px;min-height:100vh;}
h2{font-size:13px;letter-spacing:.3em;color:#c084fc;margin-bottom:12px;text-align:center;}
.card{padding:12px 14px;margin-bottom:8px;border-radius:10px;
  background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);line-height:2;}
.card.red{background:rgba(255,80,80,.12);border-color:rgba(255,80,80,.35);}
.card.green{background:rgba(80,255,180,.1);border-color:rgba(80,255,180,.35);}
.card.yellow{background:rgba(255,220,80,.1);border-color:rgba(255,220,80,.35);}
.title{font-size:10px;letter-spacing:.3em;color:rgba(255,180,255,.6);display:block;margin-bottom:4px;}
.big{font-size:22px;font-weight:bold;}
.sm{font-size:11px;color:rgba(255,255,255,.5);}
button{width:100%;padding:14px;border:none;border-radius:10px;font-size:14px;
  font-family:monospace;letter-spacing:.15em;cursor:pointer;margin-bottom:8px;
  background:linear-gradient(135deg,rgba(180,60,255,.7),rgba(255,80,180,.5));
  border:1px solid rgba(200,100,255,.6);color:#fff;}
#log{font-size:10px;color:rgba(255,255,255,.4);line-height:1.9;margin-top:8px;
  padding:10px;background:rgba(0,0,0,.3);border-radius:8px;max-height:260px;overflow-y:auto;
  white-space:pre-wrap;word-break:break-all;}
</style>
</head>
<body>
<h2>ğŸ¥½ é™€èºå„€è¨ºæ–· v2</h2>

<div class="card" id="cHttps">
  <span class="title">HTTPS ç‹€æ…‹</span>
  <span id="vHttps" class="big">â€”</span><br>
  <span id="vHttpsSub" class="sm"></span>
</div>

<div class="card" id="cSupport">
  <span class="title">DeviceOrientationEvent æ”¯æ´</span>
  <span id="vSupport" class="big">â€”</span><br>
  <span id="vSupportSub" class="sm"></span>
</div>

<div class="card" id="cPerm">
  <span class="title">æ¬Šé™ç‹€æ…‹</span>
  <span id="vPerm" class="big">â€”</span><br>
  <span id="vPermSub" class="sm"></span>
</div>

<button id="btnReq">é»æˆ‘è«‹æ±‚é™€èºå„€æ¬Šé™ï¼ˆiOS éœ€è¦ï¼‰</button>
<button id="btnListen" style="background:linear-gradient(135deg,rgba(0,180,100,.7),rgba(0,120,60,.5));border-color:rgba(0,200,120,.5);">é–‹å§‹ç›£è½ deviceorientation</button>

<div class="card" id="cEvent">
  <span class="title">æœ€æ–°äº‹ä»¶</span>
  <span id="vEvent" class="big" style="font-size:14px;">å°šæœªæ”¶åˆ°</span>
</div>

<div class="card" id="cCount">
  <span class="title">äº‹ä»¶è¨ˆæ•¸ï¼ˆæ™ƒå‹•æ‰‹æ©Ÿçœ‹é€™å€‹æ•¸å­—æœ‰æ²’æœ‰å¢åŠ ï¼‰</span>
  <span id="vCount" class="big" style="color:#80ffcc;">0</span>
</div>

<div id="log">ç­‰å¾…æ“ä½œ...</div>

<script>
function log(msg){ 
  const el = document.getElementById('log');
  el.textContent = new Date().toISOString().slice(11,23) + ' ' + msg + '\n' + el.textContent;
}

// 1. HTTPS æª¢æ¸¬
const isHttps = location.protocol === 'https:' || location.hostname === 'localhost';
const httpsCard = document.getElementById('cHttps');
document.getElementById('vHttps').textContent = location.protocol;
document.getElementById('vHttpsSub').textContent = location.href.slice(0, 60);
if(isHttps){
  httpsCard.classList.add('green');
  log('âœ… HTTPS OK: ' + location.protocol);
} else {
  httpsCard.classList.add('red');
  log('âŒ ä¸æ˜¯ HTTPSï¼Œæ„Ÿæ¸¬å™¨å¯èƒ½è¢«å°é–');
}

// 2. æ”¯æ´æª¢æ¸¬
const hasAPI = typeof DeviceOrientationEvent !== 'undefined';
const hasReqPerm = hasAPI && typeof DeviceOrientationEvent.requestPermission === 'function';
const supportCard = document.getElementById('cSupport');
document.getElementById('vSupport').textContent = hasAPI ? 'âœ… æœ‰' : 'âŒ ç„¡';
document.getElementById('vSupportSub').textContent = 
  'requestPermission: ' + (hasReqPerm ? 'æœ‰ï¼ˆiOSï¼‰' : 'ç„¡ï¼ˆAndroid/æ¡Œé¢ï¼‰');
supportCard.classList.add(hasAPI ? 'green' : 'red');
log('DeviceOrientationEvent: ' + hasAPI + ', requestPermission: ' + hasReqPerm);

// 3. Permissions API æŸ¥è©¢
async function checkPerm(){
  const permCard = document.getElementById('cPerm');
  if(navigator.permissions){
    try{
      // æœ‰äº›ç€è¦½å™¨æ”¯æ´æŸ¥è©¢ accelerometer/gyroscope
      const results = await Promise.allSettled([
        navigator.permissions.query({name:'accelerometer'}),
        navigator.permissions.query({name:'gyroscope'}),
        navigator.permissions.query({name:'magnetometer'}),
      ]);
      const names = ['accelerometer','gyroscope','magnetometer'];
      const msgs = results.map((r,i) => 
        names[i] + ': ' + (r.status==='fulfilled' ? r.value.state : 'ä¸æ”¯æ´æŸ¥è©¢')
      );
      document.getElementById('vPerm').textContent = results[1].status==='fulfilled' ? results[1].value.state : 'ç„¡æ³•æŸ¥è©¢';
      document.getElementById('vPermSub').textContent = msgs.join(' | ');
      permCard.classList.add(
        results[1].status==='fulfilled' && results[1].value.state==='granted' ? 'green' : 'yellow'
      );
      log('Permissions: ' + msgs.join(', '));
    } catch(err){
      document.getElementById('vPerm').textContent = 'æŸ¥è©¢å¤±æ•—';
      document.getElementById('vPermSub').textContent = err.message;
      permCard.classList.add('yellow');
      log('Permissions query error: ' + err.message);
    }
  } else {
    document.getElementById('vPerm').textContent = 'API ä¸å¯ç”¨';
    permCard.classList.add('yellow');
    log('navigator.permissions ä¸å­˜åœ¨');
  }
}
checkPerm();

// 4. iOS è«‹æ±‚æ¬Šé™æŒ‰éˆ•
document.getElementById('btnReq').addEventListener('click', async ()=>{
  log('é»æ“Šè«‹æ±‚æ¬Šé™...');
  if(typeof DeviceOrientationEvent !== 'undefined' && 
     typeof DeviceOrientationEvent.requestPermission === 'function'){
    try{
      const result = await DeviceOrientationEvent.requestPermission();
      log('requestPermission çµæœ: ' + result);
      alert('çµæœ: ' + result);
    } catch(err){
      log('requestPermission éŒ¯èª¤: ' + err.message);
      alert('éŒ¯èª¤: ' + err.message);
    }
  } else {
    log('æ­¤è£ç½®ä¸éœ€è¦ requestPermissionï¼ˆAndroidï¼‰');
    alert('Android è£ç½®ä¸éœ€è¦è«‹æ±‚æ¬Šé™');
  }
});

// 5. ç›£è½æŒ‰éˆ•
let listening = false;
let count = 0;
document.getElementById('btnListen').addEventListener('click', ()=>{
  if(listening) return;
  listening = true;
  log('é–‹å§‹ç›£è½ deviceorientation...');

  // åŒæ™‚ç›£è½ä¸‰ç¨®äº‹ä»¶
  window.addEventListener('deviceorientation', onOrient, true);
  window.addEventListener('deviceorientationabsolute', onOrientAbs, true);
  window.addEventListener('devicemotion', onMotion, true);

  setTimeout(()=>{
    if(count === 0){
      log('âš ï¸ 5ç§’å…§æ²’æœ‰æ”¶åˆ°ä»»ä½•äº‹ä»¶ï¼');
      log('å¯èƒ½åŸå› :');
      log('  1. Chrome éœ€è¦åœ¨ ç¶²ç«™è¨­å®š > å‹•æ…‹æ„Ÿæ‡‰å™¨ é–‹å•Ÿ');
      log('  2. ç³»çµ±è¨­å®šé—œé–‰äº†æ„Ÿæ¸¬å™¨');
      log('  3. æ¨¡æ“¬å™¨/è™›æ“¬æ©Ÿæ²’æœ‰æ„Ÿæ¸¬å™¨');
    }
  }, 5000);
});

function onOrient(e){
  count++;
  document.getElementById('vCount').textContent = count;
  const msg = `deviceorientation: Î±=${e.alpha?.toFixed(1)} Î²=${e.beta?.toFixed(1)} Î³=${e.gamma?.toFixed(1)} abs=${e.absolute}`;
  document.getElementById('vEvent').textContent = msg;
  if(count <= 5 || count % 20 === 0) log(msg);
  document.getElementById('cEvent').classList.remove('red');
  document.getElementById('cEvent').classList.add('green');
}

function onOrientAbs(e){
  if(count < 3) log(`deviceorientationabsolute: Î±=${e.alpha?.toFixed(1)} Î²=${e.beta?.toFixed(1)} Î³=${e.gamma?.toFixed(1)}`);
}

function onMotion(e){
  if(count < 3){
    const a = e.acceleration;
    log(`devicemotion: x=${a?.x?.toFixed(2)} y=${a?.y?.toFixed(2)} z=${a?.z?.toFixed(2)}`);
  }
}
</script>
</body>
</html>
